machine:
  node:
    version: 8.4.0
  environment:
    YARN_VERSION: 1.0.1

dependencies:
  cache_directories:
    - ~/.cache/yarn
  override:
    - yarn install
  post:
    - yarn global add bower
    - npm rebuild node-sass
    - bower install

test:
  override:
    - yarn run test --silent --split=$CIRCLE_NODE_TOTAL --partition=`expr $CIRCLE_NODE_INDEX + 1`:
        parallel: true
    - ember coverage-merge
    - if [ ! ${CIRCLE_PR_USERNAME} ]; then ./node_modules/coveralls/bin/coveralls.js < ./coverage/lcov.info; fi

deployment:
  production:
    branch: master
    commands:
      - 'node_modules/.bin/ember deploy production --activate'
  staging:
    branch: develop
    commands:
      - 'node_modules/.bin/ember deploy staging --activate'
